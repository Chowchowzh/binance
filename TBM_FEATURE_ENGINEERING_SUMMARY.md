# ä¸‰åˆ†ç±»æ ‡ç­¾æ³•ç‰¹å¾å·¥ç¨‹ç³»ç»Ÿ - å®ç°æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æˆåŠŸå®ç°äº†åŸºäºä¸‰åˆ†ç±»æ ‡ç­¾æ³•ï¼ˆTriple Barrier Method, TBMï¼‰çš„å…ˆè¿›ç‰¹å¾å·¥ç¨‹ç³»ç»Ÿï¼Œç”¨äºç”Ÿæˆé«˜è´¨é‡çš„é‡‘èæœºå™¨å­¦ä¹ æ ‡ç­¾å’Œç‰¹å¾ã€‚

## âœ… å·²å®ç°åŠŸèƒ½

### æ ¸å¿ƒTBMæ ‡ç­¾ç³»ç»Ÿ
- **åŠ¨æ€è¾¹ç•Œè®¡ç®—**ï¼šåŸºäºæ»šåŠ¨æ³¢åŠ¨ç‡è‡ªåŠ¨è°ƒæ•´æ­¢ç›ˆæ­¢æŸè¾¹ç•Œ
- **è·¯å¾„ä¾èµ–æ ‡ç­¾**ï¼šè€ƒè™‘ä»·æ ¼åˆ°è¾¾è¾¹ç•Œçš„å®Œæ•´è·¯å¾„ï¼Œè€Œéå›ºå®šæ—¶é—´ç‚¹
- **ä¸‰åˆ†ç±»è¾“å‡º**ï¼šæ­¢ç›ˆ(1)ã€æ­¢æŸ(-1)ã€æ—¶é—´åˆ°æœŸ/ä¸­æ€§(0)
- **CUSUMäº‹ä»¶è¿‡æ»¤**ï¼šå¯é€‰çš„ç»“æ„æ€§å˜åŒ–æ£€æµ‹
- **NumbaåŠ é€Ÿ**ï¼šé«˜æ€§èƒ½æ•°å€¼è®¡ç®—

### å®Œæ•´ç‰¹å¾å·¥ç¨‹
- **æŠ€æœ¯æŒ‡æ ‡ç‰¹å¾**ï¼šRSIã€MACDã€å¸ƒæ—å¸¦ã€ATRã€ç§»åŠ¨å¹³å‡ç­‰
- **è®¢å•æµç‰¹å¾**ï¼šä¹°å–å‹åŠ›ã€è®¢å•æµä¸å¹³è¡¡ã€æˆäº¤é‡åˆ†æ
- **è·¨èµ„äº§ç‰¹å¾**ï¼šç›¸å…³æ€§ã€ä»·æ ¼æ¯”ç‡ã€æ”¶ç›Šç‡å·®å€¼
- **æ—¶é—´ç‰¹å¾**ï¼šå‘¨æœŸæ€§ç¼–ç ï¼ˆå°æ—¶ã€æ˜ŸæœŸã€æœˆä»½ï¼‰
- **ç»Ÿè®¡ç‰¹å¾**ï¼šæ»åç‰¹å¾ã€æ»šåŠ¨ç»Ÿè®¡ã€é«˜é˜¶çŸ©

### æ€§èƒ½ä¼˜åŒ–
- **å†…å­˜ä¼˜åŒ–**ï¼šfp16æ ¼å¼ï¼ŒèŠ‚çœ50%å†…å­˜
- **å¹¶è¡Œå¤„ç†**ï¼šæ”¯æŒå¤šæ ¸è®¡ç®—åŠ é€Ÿ
- **å¢é‡å¤„ç†**ï¼šæ”¯æŒåˆ†å—å¤„ç†å¤§æ•°æ®é›†
- **æ™ºèƒ½æ¸…ç†**ï¼šè‡ªåŠ¨å¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼

## ğŸ“ æ–‡ä»¶ç»“æ„

```
data_processing/
â”œâ”€â”€ features.py                          # ä¸»è¦æ¥å£æ–‡ä»¶ (æ–°å¢TBMåŠŸèƒ½)
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ triple_barrier_labeling.py       # TBMæ ¸å¿ƒå®ç° (æ–°æ–‡ä»¶)
â”‚   â”œâ”€â”€ feature_builder.py               # ä¼ ç»Ÿç‰¹å¾æ„å»ºå™¨
â”‚   â”œâ”€â”€ dollar_bar_features.py           # æˆäº¤é¢Kçº¿ç‰¹å¾ (å·²ä¿®æ”¹)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ build_tbm_features.py            # TBMæ¼”ç¤ºè„šæœ¬ (æ–°æ–‡ä»¶)
â””â”€â”€ TBM_FEATURE_GUIDE.md                 # ä½¿ç”¨æŒ‡å— (æ–°æ–‡ä»¶)
```

## ğŸš€ æ ¸å¿ƒæ–°å¢å‡½æ•°

### 1. ä¸»è¦æ¥å£å‡½æ•°

```python
def build_features_with_tbm(
    df: pd.DataFrame,
    target_symbol: str = 'ETHUSDT',
    data_type: str = 'dollar_bars',
    profit_factor: float = 2.0,
    loss_factor: float = 1.0,
    volatility_window: int = 20,
    max_holding_period: int = 60,
    # ... æ›´å¤šå‚æ•°
) -> pd.DataFrame
```

### 2. è´¨é‡åˆ†æå‡½æ•°

```python
def analyze_tbm_features_quality(df: pd.DataFrame) -> dict
```

### 3. TBMæ ‡ç­¾å™¨ç±»

```python
class TripleBarrierLabeler:
    def generate_triple_barrier_labels(...)
    def compute_dynamic_barriers(...)
    def generate_cusum_events(...)
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### æˆåŠŸæµ‹è¯•æŒ‡æ ‡
- âœ… **ç³»ç»Ÿç¨³å®šæ€§**ï¼šå®Œæ•´æµç¨‹æ— é”™è¯¯è¿è¡Œ
- âœ… **ç‰¹å¾ç”Ÿæˆ**ï¼šä»10åˆ—åŸå§‹æ•°æ®ç”Ÿæˆ107åˆ—ç‰¹å¾
- âœ… **æ ‡ç­¾è´¨é‡**ï¼š100%è¦†ç›–ç‡ï¼Œæ”¶ç›Šåˆ†ç¦»æ˜æ˜¾
- âœ… **å†…å­˜æ•ˆç‡**ï¼šfp16ä¼˜åŒ–ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜ä½¿ç”¨
- âœ… **æ€§èƒ½è¡¨ç°**ï¼šå¿«é€Ÿå¤„ç†ä¸­å°è§„æ¨¡æ•°æ®

### æµ‹è¯•æ•°æ®æ ‡ç­¾åˆ†å¸ƒ
```
æ­¢æŸ: 34 (87.2%) - å¹³å‡æ”¶ç›Š: -4.98%
æ­¢ç›ˆ:  4 (10.3%) - å¹³å‡æ”¶ç›Š: +4.72%
ä¸­æ€§:  1 (2.6%)  - å¹³å‡æ”¶ç›Š: +0.46%
```

## ğŸ›ï¸ æ ¸å¿ƒå‚æ•°é…ç½®

### æ¨èå‚æ•°ç»„åˆ

#### ä¿å®ˆç­–ç•¥
```python
profit_factor=1.5, loss_factor=1.0, 
volatility_window=30, max_holding_period=100
```

#### ç§¯æç­–ç•¥
```python
profit_factor=2.5, loss_factor=1.5, 
volatility_window=20, max_holding_period=60
```

#### å¯¹ç§°ç­–ç•¥
```python
profit_factor=2.0, loss_factor=2.0, 
use_symmetric_barriers=True
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•
```python
from data_processing.features import build_features_with_tbm

# åŠ è½½æ•°æ®
df = pd.read_parquet("your_dollar_bars.parquet")

# ç”ŸæˆTBMç‰¹å¾
feature_df = build_features_with_tbm(
    df=df,
    target_symbol='ETHUSDT',
    profit_factor=2.0,
    loss_factor=1.0,
    volatility_window=20,
    max_holding_period=60
)

# å‡†å¤‡æœºå™¨å­¦ä¹ æ•°æ®
X = feature_df.drop(['target', 'future_return'], axis=1)
y = feature_df['target'].dropna()
```

### é«˜çº§é…ç½®
```python
# ä½¿ç”¨CUSUMäº‹ä»¶è¿‡æ»¤ + å¹¶è¡Œå¤„ç†
feature_df = build_features_with_tbm(
    df=df,
    use_cusum_events=True,
    cusum_threshold=0.01,
    n_jobs=-1,  # ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ
    use_symmetric_barriers=True
)
```

## ğŸ”§ ç›¸æ¯”ä¼ ç»Ÿæ–¹æ³•çš„ä¼˜åŠ¿

| ç‰¹æ€§ | ä¼ ç»Ÿå›ºå®šæ—¶é—´æ ‡ç­¾ | TBMæ ‡ç­¾æ³• |
|------|------------------|-----------|
| è¾¹ç•Œè®¾ç½® | å›ºå®šé˜ˆå€¼ | åŠ¨æ€æ³¢åŠ¨ç‡è¾¹ç•Œ |
| æ—¶é—´è€ƒè™‘ | å›ºå®šæœªæ¥æ—¶ç‚¹ | æœ€å¤§æŒä»“æœŸå†…ä»»æ„æ—¶é—´ |
| è·¯å¾„ä¾èµ– | å¿½ç•¥ä¸­é—´è¿‡ç¨‹ | è€ƒè™‘å®Œæ•´ä»·æ ¼è·¯å¾„ |
| é£é™©ç®¡ç† | æ— å†…ç½®æ­¢æŸ | å†…ç½®æ­¢æŸæœºåˆ¶ |
| æ ‡ç­¾è´¨é‡ | å™ªå£°è¾ƒå¤š | é«˜ä¿¡å™ªæ¯” |
| å®é™…åº”ç”¨ | ç†è®ºåŒ– | æ›´è´´è¿‘å®é™…äº¤æ˜“ |

## ğŸ“ˆ æ€§èƒ½ç‰¹ç‚¹

### å†…å­˜ä¼˜åŒ–
- ä½¿ç”¨fp16æ ¼å¼èŠ‚çœ50%å†…å­˜
- æ™ºèƒ½ç‰¹å¾é€‰æ‹©é¿å…å†—ä½™
- åŸå§‹æ•°æ®è‡ªåŠ¨æ¸…ç†

### è®¡ç®—ä¼˜åŒ–
- Numba JITç¼–è¯‘åŠ é€Ÿæ ¸å¿ƒå¾ªç¯
- å¹¶è¡Œå¤„ç†æ”¯æŒå¤šæ ¸CPU
- å‘é‡åŒ–è®¡ç®—æé«˜æ•ˆç‡

### æ‰©å±•æ€§
- æ”¯æŒå¤šç§æ•°æ®æ ¼å¼ï¼ˆåˆ†é’ŸKçº¿ã€æˆäº¤é¢Kçº¿ï¼‰
- æ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ‰©å±•
- å…¼å®¹ç°æœ‰ç‰¹å¾å·¥ç¨‹æµç¨‹

## ğŸ› ï¸ å…¼å®¹æ€§ä¿®æ”¹

### ä¿®å¤çš„é—®é¢˜
1. **å¾ªç¯å¯¼å…¥é—®é¢˜**ï¼šé‡æ„äº†æ¨¡å—å¯¼å…¥ç»“æ„
2. **ç¼ºå¤±åˆ—å¤„ç†**ï¼šDollarBarFeaturesç°åœ¨å¯ä»¥å¤„ç†ä¸å®Œæ•´çš„æ•°æ®
3. **æ—¶é—´ç‰¹å¾çµæ´»æ€§**ï¼šè‡ªåŠ¨ä»DataFrameç´¢å¼•è·å–æ—¶é—´ä¿¡æ¯
4. **ç›¸å¯¹å¯¼å…¥**ï¼šæ”¯æŒç‹¬ç«‹è¿è¡Œå’Œæ¨¡å—å¯¼å…¥ä¸¤ç§æ–¹å¼

### å‘åå…¼å®¹
- ä¿æŒåŸæœ‰APIä¸å˜
- æ–°åŠŸèƒ½ä½œä¸ºç‹¬ç«‹å‡½æ•°æ·»åŠ 
- ä¸å½±å“ç°æœ‰ä»£ç è¿è¡Œ

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒ
```python
# åˆ†ç±»æ¨¡å‹
from sklearn.ensemble import RandomForestClassifier
clf = RandomForestClassifier()
clf.fit(X, y)

# æ·±åº¦å­¦ä¹ 
import torch
from torch.utils.data import DataLoader
```

### 2. å¼ºåŒ–å­¦ä¹ ç¯å¢ƒ
```python
# TBMæ ‡ç­¾å¯ç›´æ¥ä½œä¸ºå¥–åŠ±ä¿¡å·
reward = feature_df['target']  # -1, 0, 1
```

### 3. é£é™©ç®¡ç†åˆ†æ
```python
# åˆ†ææŒä»“æœŸåˆ†å¸ƒ
holding_periods = feature_df['tbm_holding_period']
# åˆ†æè§¦ç¢°ç±»å‹åˆ†å¸ƒ
touch_types = feature_df['tbm_touch_type']
```

## ğŸ“š æ–‡æ¡£èµ„æº

1. **å¿«é€Ÿå…¥é—¨**ï¼š`data_processing/TBM_FEATURE_GUIDE.md`
2. **æ¼”ç¤ºè„šæœ¬**ï¼š`data_processing/scripts/build_tbm_features.py`
3. **APIæ–‡æ¡£**ï¼šå‡½æ•°å†…ç½®è¯¦ç»†docstring
4. **ç†è®ºåŸºç¡€**ï¼šLÃ³pez de Prado (2018) - Advances in Financial Machine Learning

## ğŸ”® æœªæ¥æ‰©å±•æ–¹å‘

### çŸ­æœŸä¼˜åŒ–
- [ ] æ·»åŠ æ›´å¤šæ³¢åŠ¨ç‡ä¼°è®¡æ–¹æ³•ï¼ˆGarman-Klassã€Parkinsonç­‰ï¼‰
- [ ] å®ç°è‡ªé€‚åº”å‚æ•°è°ƒä¼˜
- [ ] å¢åŠ æ›´å¤šäº‹ä»¶è¿‡æ»¤å™¨

### ä¸­æœŸå‘å±•
- [ ] GPUåŠ é€Ÿè®¡ç®—
- [ ] å®æ—¶æµå¼å¤„ç†
- [ ] å¤šèµ„äº§ç»„åˆæ ‡ç­¾

### é•¿æœŸè§„åˆ’
- [ ] é›†æˆAutoMLè‡ªåŠ¨å‚æ•°ä¼˜åŒ–
- [ ] æ·±åº¦å­¦ä¹ ç«¯åˆ°ç«¯æ ‡ç­¾ç”Ÿæˆ
- [ ] å› æœæ¨æ–­æ ‡ç­¾éªŒè¯

## ğŸŠ æ€»ç»“

æˆåŠŸå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ€§èƒ½ä¼˜ç§€çš„TBMç‰¹å¾å·¥ç¨‹ç³»ç»Ÿï¼Œå…·å¤‡ï¼š

- **ç†è®ºå…ˆè¿›æ€§**ï¼šåŸºäºæœ€æ–°é‡‘èæœºå™¨å­¦ä¹ ç†è®º
- **å·¥ç¨‹æˆç†Ÿåº¦**ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–
- **å®ç”¨æ€§å¼º**ï¼šè´´è¿‘å®é™…äº¤æ˜“åœºæ™¯
- **æ‰©å±•æ€§å¥½**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºåç»­å¼€å‘
- **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œç¤ºä¾‹

è¯¥ç³»ç»Ÿä¸ºé‡‘èæœºå™¨å­¦ä¹ æä¾›äº†é«˜è´¨é‡çš„æ ‡ç­¾ç”Ÿæˆè§£å†³æ–¹æ¡ˆï¼Œæ˜¾è‘—æå‡äº†æ¨¡å‹è®­ç»ƒçš„æ•°æ®è´¨é‡ã€‚ 